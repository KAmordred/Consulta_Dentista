{% extends 'Plantilla_base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}
{% block title %}Carrito de Compras{% endblock %}

{% block content %}
<div class="container">
    <br>
    <h2>Carrito de Compras</h2>
    <div class="row">
        <div class="col-md-8">
            <!-- Lista de productos en el carrito -->
            <div class="card">
                <div class="card-header">
                    <h4>Productos en tu carrito</h4>
                </div>
                <div class="card-body">
                    {% if carrito %}
                        <ul class="list-group">
                            {% for id, item in carrito.items %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <img src="{{ item.imagen_url }}" alt="{{ item.nombre }}" class="img-thumbnail" style="width: 100px; height: 100px;">
                                        <h5>{{ item.nombre }}</h5>
                                        <p class="mb-1">Precio: ${{ item.precio|intcomma }}</p>
                                        <form action="{% url 'actualizar_cantidad' id %}" method="post">
                                            {% csrf_token %}
                                            <div class="d-flex align-items-center">
                                                <button type="submit" name="cantidad" value="{{ item.cantidad|add:-1 }}" class="btn btn-sm btn-outline-secondary">-</button>
                                                <input type="text" class="form-control form-control-sm text-center mx-1" value="{{ item.cantidad }}" style="width: 50px;" readonly>
                                                <button type="submit" name="cantidad" value="{{ item.cantidad|add:1 }}" class="btn btn-sm btn-outline-secondary">+</button>
                                            </div>
                                        </form>
                                        <p class="mb-1">Stock disponible: {{ item.stock }}</p>
                                    </div>
                                    <div>
                                        <a href="{% url 'eliminar_del_carrito' id %}" class="btn btn-danger btn-sm">Eliminar</a>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No hay productos en tu carrito.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <!-- Resumen del carrito -->
            <div class="card">
                <div class="card-header">
                    <h4>Resumen</h4>
                </div>
                <div class="card-body">
                    <p><strong>Sub Total:</strong> ${{ subtotal|intcomma }}</p>
                    <p><strong>IVA (19%):</strong> ${{ iva|intcomma }}</p>
                    <p><strong>Total:</strong> ${{ total|intcomma }}</p>
                    <a href="#" class="btn btn-primary btn-block">Proceder al Pago</a>
                </div>
            </div>
            <!-- Opciones de envío -->
            <div class="card mt-3">
                <div class="card-header">
                    <h4>Opciones de envío</h4>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="envio" id="retiroTienda" value="retiro" checked>
                        <label class="form-check-label" for="retiroTienda">Retiro en tienda ($0) <br> <strong>Región Metropolitana($0)</strong></label>
                    </div>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="radio" name="envio" id="despachoDomicilio" value="despacho">
                        <label class="form-check-label" for="despachoDomicilio">Despacho a domicilio (+$4.500)</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
